---
layout: default
title: Daily Status - 2026-02-04
date: 2026-02-04
---

# Daily Status - 2026-02-04

## Accomplishments
- Fixed AAP template lookup to use query parameters and cache full Template objects ([MGMT-23031](https://issues.redhat.com/browse/MGMT-23031))
- Fixed AAP API version path construction (changed from `/api/controller/api/v2/` to `/api/controller/v2/`)
- Fixed Job.ExtraVars JSON parsing to handle AAP's string-encoded response format
- Fixed job status polling bugs: provision status now updates after VM ready, deprovision status properly persisted before finalizer removal
- Implemented EDA event structure wrapper for template compatibility with full Kubernetes resource serialization
- Completed successful end-to-end provision workflow with real template (`osac.templates.ocp_virt_vm`) - VM created and running
- Verified full lifecycle test with osac-test-infra restart workflow - provision, restart, and cleanup all successful
- Identified and documented finalizer removal issue root cause: `kubectl.kubernetes.io/last-applied-configuration` annotation causes client-side apply validation differences
- Created reusable deployment automation script (`~/work/scripts/deploy-cloudkit-operator.sh`)
- Deployed and verified bug fixes in production environment (image: `aap-provisioning-48a61a9`)
- Designed implementation plan for canceling provision jobs before deprovision to prevent race conditions
- Implemented AAP job cancellation infrastructure: added `JobStateCanceled` constant, `CancelProvision()` interface method, `CanCancelJob()` and `CancelJob()` client methods, updated status mapping and controller deprovisioning logic

## Risks & Challenges
- Deprovision jobs fail consistently with "spec: Required value" error during finalizer removal (playbook uses client-side apply which requires full schema validation when `last-applied-configuration` annotation is present)
- Potential race condition when deleting ComputeInstance while provision job is running - both provision and deprovision jobs may execute simultaneously (mitigation: implement provision job cancellation before deprovision - **IN PROGRESS**)
- AAP job cancellation is asynchronous - tasks already dispatched to remote hosts will run to completion even after SIGINT is sent

## Key Effort
Completed AAP provisioning integration end-to-end testing, fixed critical job status polling bugs, identified root causes for finalizer removal failures, and implemented job cancellation infrastructure to prevent race conditions during deletion.
