---
layout: default
title: Daily Status - 2026-02-04
date: 2026-02-04
---

# Daily Status - 2026-02-04

## Accomplishments
- Fixed template lookup URL construction to use query parameters instead of path-based lookup ([MGMT-23031](https://issues.redhat.com/browse/MGMT-23031))
- Corrected API version path from `/api/controller/api/v2/` to `/api/controller/v2/`
- Fixed `Job.ExtraVars` JSON parsing by changing type from map to string
- Resolved job status polling bug where provision job status stayed "Running" after VM ready
- Fixed deprovision job status persistence issue caused by `r.Update()` overwriting in-memory changes
- Implemented EDA event structure wrapper for template compatibility with existing AAP playbooks
- Added full resource serialization to properly populate EDA payload with complete Kubernetes object
- Verified successful E2E provision workflow with real template (`osac.templates.ocp_virt_vm`)
- Identified and documented finalizer removal failure root cause (`kubectl.kubernetes.io/last-applied-configuration` annotation)
- Validated full lifecycle (create → provision → ready → restart → delete) using osac-test-infra restart test
- Created deployment automation script (`~/work/scripts/deploy-cloudkit-operator.sh`)
- Designed implementation plan for canceling provision jobs before deprovision to prevent race conditions
- Completed AAP job cancellation API implementation with `CanCancelJob()` and `CancelJob()` methods
- Added `JobStateCanceled` to provisioning provider interface with terminal state handling

## Risks & Challenges
- Deprovision jobs consistently fail with "spec: Required value" error when removing finalizers (playbook design issue, not blocking - VMs delete successfully)
- Discovered potential race condition when deleting ComputeInstance during active provisioning (orphaned VMs possible)
- AAP job cancellation is asynchronous - tasks already dispatched continue running despite SIGINT
- Need osac-test-infra test to verify deletion-during-provisioning behavior and orphaned VM prevention

## Key Effort
Completed AAP provisioning integration E2E testing, fixed critical job status polling bugs, and designed race condition prevention via provision job cancellation.
