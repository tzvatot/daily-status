---
layout: default
title: Daily Status - 2026-02-04
date: 2026-02-04
---

# Daily Status - 2026-02-04

## Accomplishments
- Fixed AAP template lookup to use query parameters instead of path-based URLs ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Refactored template caching to store full Template objects with ID, Name, and Type fields
  - Implemented `getTemplateFromEndpoint()` helper for query-based lookups
  - All 58 tests passing
- Fixed API version path construction ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Changed APIVersion constant from "api/v2" to "v2" to prevent double path segments
  - Exported all path constants for test consistency
- Fixed Job.ExtraVars JSON parsing ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Changed field type from map to string to handle AAP's JSON-encoded response format
- Implemented EDA event structure wrapper for template compatibility ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Created `extractEDAPayload()` helper to wrap parameters in ansible_eda.event.payload structure
  - Implemented `serializeResource()` to send full Kubernetes resource object to playbooks
- Completed successful E2E provision test with real template ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Used osac.templates.ocp_virt_vm template
  - AAP Job 4220 succeeded, VirtualMachine created and running
  - ComputeInstance reached Ready phase with populated virtualMachineReference
- Fixed critical job status polling bugs ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Bug #1: Provision job status now updates to terminal state after VM ready
  - Bug #2: Deprovision job status now persisted before finalizer removal
  - Verified both fixes in production with test-status-fix resource
- Created deployment automation script
  - Reusable script: ~/work/scripts/deploy-cloudkit-operator.sh
  - Automates build → push → deploy → rollout workflow
- Completed full lifecycle E2E testing ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Provision flow: ✅ VMs created successfully
  - Deprovision flow: ✅ VMs deleted successfully
  - Controller handles job failures gracefully

## Risks & Challenges
- Deprovision jobs fail consistently with "spec: Required value" error when removing finalizer
  - Playbook's kubernetes.core.k8s module fails on metadata-only patch
  - Functional impact: NONE (VMs still deleted, cleanup completes)
  - Observability impact: AAP jobs show "failed" even though work succeeded
  - Root cause unclear: EDA job 3197 succeeded with identical definition, AAP job 4223 failed
- Job status polling may need refinement
  - Fixed terminal state detection, but polling frequency/timeout may need tuning

## Key Effort
AAP provisioning E2E testing with bug fixes and job status polling improvements
