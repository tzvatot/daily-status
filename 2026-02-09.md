---
layout: default
title: Daily Status - 2026-02-09
date: 2026-02-09
---

# Daily Status - 2026-02-09

## Accomplishments
- Completed provider abstraction refactoring - eliminated all `switch r.ProvisioningProvider.Name()` statements from controller by using richer result types and CRD changes ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
- Added `BlockDeletionOnFailure` field to JobStatus CRD to store deletion policy set by provider during deprovision trigger
- Created new result types (`ProvisionResult`, `DeprovisionResult`, `DeprovisionAction`) and updated `ProvisioningProvider` interface
- Updated AAP and EDA provider implementations to internalize provider-specific logic (cancellation, finalizer checks)
- Eliminated both critical switch statements from controller (lines 426-452 for deprovision failure handling, lines 546-570 for deletion flow decision)
- All 90+ unit tests passing with zero linter issues after refactoring
- Deployed refactored operator: `quay.io/etabak/cloudkit-operator:74ced2e`
- Fixed EDA deletion infinite polling bug by adding resource parameter to `GetProvisionStatus()` and `GetDeprovisionStatus()` interface methods
- EDA provider now checks AAP finalizer removal to detect completion instead of relying on job status
- Deployed bug fix: `quay.io/etabak/cloudkit-operator:96423b5`
- Validated fix with end-to-end test script - ComputeInstance lifecycle (creation, verification, deletion) completed successfully
- Fixed vmaas-dev environment EDA webhook configuration - corrected URLs to point to `innabox-aap-eda-api:8000` service
- Improved latency experiment script provider verification to check pod environment variables instead of logs
- Discovered and validated genuine EDA performance improvement - provision time improved from 649s to ~140s (4.3x faster)
- Ruled out operator code changes as cause by testing official upstream image - showed same fast performance (135s vs 144s)
- Corrected webhook configuration understanding - `innabox-eda-service:5000` is dynamically created by activation jobs
- Pushed commits `74ced2e` and `96423b5` to `tzvatot/cloudkit-operator:feature/aap-provisioning-[MGMT-23031](https://issues.redhat.com/browse/MGMT-23031)`

## Risks & Challenges
- **BUG DISCOVERED:** Concurrent provision and deprovision jobs running simultaneously - ComputeInstance `vm-jgkx2` shows provision job 7265 still running while deprovision job 7267 already started, indicating cancellation logic may not be working correctly or race condition exists
- **Mystery:** Need to investigate what changed in AAP/EDA infrastructure between Feb 8-9 that caused 4.3x speedup in EDA provision times
- **CRITICAL (carried forward):** AAP Direct missing ReconciledConfigVersion update when provision job succeeds - controller can't detect if spec changed vs already reconciled without this

## Key Effort
Achieved clean provider abstraction by eliminating controller type switches and fixing EDA deletion bugs through enhanced provider interfaces.
