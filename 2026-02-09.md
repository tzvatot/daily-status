---
layout: default
title: Daily Status - 2026-02-09
date: 2026-02-09
---

# Daily Status - 2026-02-09

## Accomplishments
- Completed provider abstraction refactoring ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Eliminated all provider type switches from controller
  - Added BlockDeletionOnFailure field to CRD for crash-safe deletion policies
  - Created rich result types (ProvisionResult, DeprovisionResult) to move provider-specific logic into provider implementations
  - Internalized AAP cancellation logic and EDA finalizer checking into provider implementations
  - All 90+ tests passing, zero linter issues
  - Deployed refactored operator: `quay.io/etabak/cloudkit-operator:74ced2e`
- Fixed EDA deletion infinite polling bug ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Added resource parameter to GetProvisionStatus() and GetDeprovisionStatus() interface methods
  - EDA provider now checks AAP finalizer to detect completion (finalizer removal signals playbook completion)
  - Maintains clean abstraction - no controller changes needed
  - Deployed fixed operator: `quay.io/etabak/cloudkit-operator:96423b5`
  - Validated with end-to-end test script showing successful deletion without infinite polling
- Fixed EDA webhook configuration in vmaas-dev environment
  - Diagnosed root cause: Deployment configured with non-existent service URLs (`innabox-eda-service:5000` was being referenced but service is dynamically created)
  - Updated webhook URLs to point to correct service endpoints
  - Improved experiment script provider verification (checks environment variables instead of pod logs)
  - Cleaned up stuck VMs and processes
- Investigated EDA performance improvement
  - Discovered EDA provision time improved from 649s (Feb 8) to ~140s (4.3x faster)
  - Verified speedup is real through controlled testing with both custom and official upstream operator images
  - Ruled out operator code changes as cause - speedup due to external infrastructure improvements
  - Documented dynamic vs static EDA service architecture and corrected webhook configuration understanding
- Pushed commits `74ced2e` and `96423b5` to `tzvatot/cloudkit-operator:feature/aap-provisioning-[MGMT-23031](https://issues.redhat.com/browse/MGMT-23031)`

## Risks & Challenges
- **BUG DISCOVERED:** Concurrent provision and deprovision jobs running simultaneously
  - Provision job (7265) still running during deletion instead of being cancelled
  - Deprovision job (7267) started prematurely while provision still running
  - Possible race condition in AAP provider's isReadyForDeprovision() cancellation logic
  - Investigation in progress
- **CRITICAL (Carried forward):** AAP Direct missing ReconciledConfigVersion update
  - AAP Direct doesn't set ReconciledConfigVersion when provision job succeeds
  - Without this, controller can't detect if spec changed vs already reconciled
  - Fix needed in internal/provisioning/aap_provider.go:178 - getJobStatus()

## Key Effort
Eliminated all provider type switches from controller through provider abstraction refactoring, moving provider-specific logic into provider implementations while maintaining clean separation of concerns.
