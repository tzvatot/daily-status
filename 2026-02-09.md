---
layout: default
title: Daily Status - 2026-02-09
date: 2026-02-09
---

# Daily Status - 2026-02-09

## Accomplishments
- Provider abstraction refactoring complete - eliminated all `switch r.ProvisioningProvider.Name()` statements from controller by using richer result types (`ProvisionResult`, `DeprovisionResult`) and added `BlockDeletionOnFailure` field to CRD. All 90+ tests passing, zero linter issues.
- Fixed EDA deletion infinite polling bug by adding resource parameter to `GetProvisionStatus()` and `GetDeprovisionStatus()` interface methods, allowing EDA provider to check AAP finalizer removal for completion detection. Deployed and validated end-to-end.
- Fixed vmaas-dev environment - corrected webhook URLs from non-existent `innabox-eda-service:5000` to `innabox-aap-eda-api:8000` (later corrected understanding of dynamic service creation). Improved experiment script to verify provider via environment variables instead of logs.
- Investigated EDA performance improvement - discovered genuine 4.3x speedup (649s â†’ ~140s) between Feb 8-9. Ruled out operator code changes by testing official upstream image (similar performance). Speedup attributed to external infrastructure improvements.
- Fixed job state mapping inconsistencies - corrected AAP status mapping where `"pending"`, `"waiting"`, and `"running"` all incorrectly mapped to `JobStateRunning`. Added `JobStateWaiting` and `JobStateUnknown` states, updated CRD enum validation, added comprehensive unit tests (39 specs), deployed and verified with both AAP and EDA providers.
- Created test automation scripts - `create_ci.sh` for ComputeInstance creation and `delete_ci.sh` for deletion, both using `--as system:admin` for kubectl operations.
- Code commits and deployment:
  - Commit `74ced2e` - Provider abstraction refactoring
  - Commit `96423b5` - Fix EDA deletion infinite polling  
  - Commit `47428b4` - Fix job state mapping inconsistencies
  - Commit `fad351a` - Add Waiting and Unknown states to JobStatus CRD enum
  - Deployed images: `quay.io/etabak/cloudkit-operator:74ced2e`, `quay.io/etabak/cloudkit-operator:96423b5`, `quay.io/etabak/cloudkit-operator:47428b4`
- Work tracked under [MGMT-22880](https://issues.redhat.com/browse/MGMT-22880) - AAP Provisioning Abstraction

## Risks & Challenges
- Discovered bug: concurrent provision and deprovision jobs can run simultaneously (provision job 7265 still running when deprovision job 7267 started). Expected behavior is provision cancellation before deprovision starts. Needs investigation of race conditions and cancellation flow.
- Critical issue carried forward: AAP Direct missing ReconciledConfigVersion update when provision succeeds. Without this, controller can't detect spec changes vs already reconciled state.
- Test scripts need provider-aware logic (AAP expects state transitions, EDA doesn't support polling).
- Need to investigate what changed in AAP/EDA infrastructure between Feb 8-9 that caused 4.3x speedup.

## Key Effort
Completed provider abstraction refactoring to eliminate type switches from controller and fixed multiple bugs in job state handling and deletion flows.
