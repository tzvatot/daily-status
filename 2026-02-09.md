---
layout: default
title: Daily Status - 2026-02-09
date: 2026-02-09
---

# Daily Status - 2026-02-09

## Accomplishments
- Fixed provider abstraction refactoring by eliminating all `switch r.ProvisioningProvider.Name()` statements from controller ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Added `BlockDeletionOnFailure` field to CRD for crash-safe deletion policies
  - Created rich result types (`ProvisionResult`, `DeprovisionResult`) and updated provider interface
  - Moved provider-specific logic into AAP and EDA provider implementations
  - All 90+ unit tests passing, zero linter issues
  - Deployed refactored operator: `quay.io/etabak/cloudkit-operator:74ced2e`
- Fixed EDA deletion infinite polling bug ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Added `resource client.Object` parameter to `GetProvisionStatus()` and `GetDeprovisionStatus()` interface methods
  - EDA provider now checks AAP finalizer to detect completion instead of always returning `Running`
  - Maintains clean abstraction - no controller changes needed
  - Deployed fixed operator: `quay.io/etabak/cloudkit-operator:96423b5`
  - Created and validated end-to-end test script: `~/work/scripts/test_compute_instance.sh`
- Fixed EDA webhook configuration in vmaas-dev environment ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Corrected ComputeInstance webhook URLs from non-existent `innabox-eda-service:5000` to `innabox-aap-eda-api:8000`
  - Later reverted after discovering `innabox-eda-service` is dynamically created by activation jobs
  - Improved experiment script to verify provider via environment variables instead of logs
  - Cleaned up stuck VMs and processes from failed runs
- Investigated EDA performance improvement ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Discovered EDA provision time improved from 649s (Feb 8) to ~140s (4.3x speedup)
  - Verified speedup is real through controlled testing with both custom and official operator images
  - Ruled out operator code changes as cause - speedup is external (AAP/EDA infrastructure)
  - Documented dynamic vs static EDA service architecture
- Fixed job state mapping inconsistencies ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Added `JobStateWaiting` and `JobStateUnknown` states to properly map AAP statuses
  - Fixed AAP provider to correctly map `"pending"` â†’ `JobStatePending` (was incorrectly `JobStateRunning`)
  - Updated EDA provider to return `JobStateUnknown` (was `JobStatePending`) since it can't poll status
  - Added comprehensive unit tests for all AAP status mappings (39 specs passing)
  - Updated CRD enum validation to support new states
  - Deployed and verified: `quay.io/etabak/cloudkit-operator:47428b4`
  - Created automation scripts: `~/work/scripts/create_ci.sh`, `~/work/scripts/delete_ci.sh`

## Risks & Challenges
- Discovered bug during testing: ComputeInstance `vm-jgkx2` had concurrent provision job (7265) and deprovision job (7267) both running simultaneously, indicating race condition in job cancellation logic
- Outstanding mystery: What changed in AAP/EDA infrastructure between Feb 8-9 to cause 4.3x speedup in provision times
- Need to investigate [MGMT-22880](https://issues.redhat.com/browse/MGMT-22880) - AAP Direct missing ReconciledConfigVersion update when provision job succeeds

## Key Effort
Provider abstraction refactoring and EDA deletion bug fixes with comprehensive testing and deployment validation
