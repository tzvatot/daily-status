---
layout: default
title: Daily Status - 2026-02-09
date: 2026-02-09
---

# Daily Status - 2026-02-09

## Accomplishments

- Completed provider abstraction refactoring - eliminated all `switch r.ProvisioningProvider.Name()` statements from controller (MGMT-22880)
  - Created rich result types (`ProvisionResult`, `DeprovisionResult`) to eliminate type switching
  - Added `BlockDeletionOnFailure` field to CRD for crash-safe deletion policies
  - Internalized provider-specific logic into AAP and EDA provider implementations
  - Updated [MGMT-22880](https://issues.redhat.com/browse/MGMT-22880) with refactoring completion
  - All 90+ unit tests passing, zero linter issues

- Fixed EDA deletion infinite polling bug (MGMT-22880)
  - Added resource parameter to `GetProvisionStatus()` and `GetDeprovisionStatus()` interface methods
  - EDA provider now checks AAP finalizer to detect completion instead of polling job status
  - Maintains clean abstraction without controller changes

- Fixed job state mapping inconsistencies in provisioning providers (MGMT-22880)
  - Added `JobStateWaiting` and `JobStateUnknown` states to CRD
  - Fixed AAP status mapping (pending/waiting/running were all incorrectly mapped to Running)
  - Added comprehensive unit tests for all AAP status transitions (39 specs)
  - Deployed and verified with both AAP and EDA providers

- Fixed EDA webhook configuration in vmaas-dev environment (MGMT-22880)
  - Corrected cloudkit-operator deployment to use `innabox-aap-eda-api:8000` (actual service) instead of `innabox-eda-service:5000` (non-existent)
  - Updated latency experiment script with improved provider verification (checks env vars instead of logs)
  - Later discovered `innabox-eda-service:5000` is dynamically created by EDA activation jobs - reverted to correct configuration

- Investigated EDA performance improvement (MGMT-22880)
  - Discovered EDA provision time improved from 649s (Feb 8) to ~140s (4.3x faster)
  - Ruled out operator code changes as cause by testing official upstream image (same performance)
  - Identified external infrastructure improvements (AAP/EDA/Ansible) as likely cause

- Created automation scripts for testing
  - `~/work/scripts/create_ci.sh` - Creates ComputeInstance without cleanup
  - `~/work/scripts/delete_ci.sh` - Deletes ComputeInstance by UUID
  - `~/work/scripts/monitor_experiment.sh` - 5-minute polling monitor for experiments

- Deployed refactored operator builds
  - `quay.io/etabak/cloudkit-operator:74ced2e` - Initial refactoring
  - `quay.io/etabak/cloudkit-operator:96423b5` - EDA deletion fix
  - `quay.io/etabak/cloudkit-operator:47428b4` - Job state mapping fixes
  - `quay.io/etabak/cloudkit-operator:fad351a` - CRD enum validation update

- Pushed code to feature branch `tzvatot/cloudkit-operator:feature/aap-provisioning-MGMT-23031`

## Risks & Challenges

- **Bug discovered:** Concurrent provision and deprovision jobs running simultaneously on `vm-jgkx2` - provision job (7265) still running while deprovision job (7267) was started. Expected behavior: provision should be cancelled before deprovision starts. Requires investigation into race conditions in AAP provider's `isReadyForDeprovision()` logic.

- **Outstanding issue:** AAP Direct missing ReconciledConfigVersion update when provision job succeeds. Without this, controller can't detect spec changes vs already reconciled state. Needs fix in `getJobStatus()` method.

- **Mystery:** Unknown infrastructure change between Feb 8-9 caused 4.3x EDA speedup (649s â†’ 140s). Need to investigate AAP/EDA/Ansible changes.

## Key Effort

Provider abstraction refactoring to eliminate all type switching in controller, enabling clean provider-agnostic architecture with crash-safe deletion policies.
