---
layout: default
title: Daily Status - 2026-02-09
date: 2026-02-09
---

# Daily Status - 2026-02-09

## Accomplishments
- Completed provider abstraction refactoring to eliminate all type switches from controller ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Added `BlockDeletionOnFailure` field to CRD for crash-safe deletion policies
  - Created rich result types (`ProvisionResult`, `DeprovisionResult`) to move provider-specific logic into provider implementations
  - Internalized AAP cancellation logic and EDA finalizer checking into respective providers
  - Eliminated both critical switch statements (deprovision failure handling and deletion flow)
  - All 90+ unit tests passing with zero linter issues
- Fixed EDA deletion infinite polling bug
  - Added resource parameter to `GetProvisionStatus()` and `GetDeprovisionStatus()` interface methods
  - EDA provider now checks AAP finalizer removal to detect completion instead of always returning Running
  - Maintains clean abstraction without controller changes
  - Deployed and validated with end-to-end test (ComputeInstance `019c41fe-449f-7c8a-baf3-b4bfa59f6cd2`)
- Fixed EDA webhook configuration in vmaas-dev environment
  - Corrected deployment webhook URLs from non-existent `innabox-eda-service:5000` to working `innabox-aap-eda-api:8000`
  - Improved experiment script provider verification to check pod environment variables instead of logs
  - Cleaned up stuck VMs and processes
- Investigated EDA performance improvement
  - Discovered EDA provision time improved from 649s to ~140s (4.3x faster than Feb 8)
  - Ruled out operator code changes as cause by testing official upstream image
  - Corrected webhook configuration understanding (dynamic vs static EDA services)
  - Verified speedup is real and caused by external infrastructure improvements
- Deployed refactored operator images: `quay.io/etabak/cloudkit-operator:74ced2e` (initial refactoring) and `96423b5` (EDA deletion fix)
- Pushed commits to `tzvatot/cloudkit-operator:feature/aap-provisioning-[MGMT-23031](https://issues.redhat.com/browse/MGMT-23031)` branch

## Risks & Challenges
- **CRITICAL BUG DISCOVERED:** Concurrent provision and deprovision jobs running simultaneously
  - ComputeInstance `vm-jgkx2` shows provision job (7265) still running while deprovision job (7267) was started
  - Provision job should have been cancelled before deprovision started
  - Inconsistent job state (deprovision reports State=Running but Message="pending")
  - Potential race condition in AAP provider's `isReadyForDeprovision()` method
  - Investigation in progress
- **Carry-forward issue:** AAP Direct missing ReconciledConfigVersion update when provision succeeds
  - Without this, controller can't detect if spec changed vs already reconciled
  - Fix needed in `internal/provisioning/aap_provider.go:178` to populate ReconciledVersion field

## Key Effort
Eliminated provider type switches from controller through interface refactoring and discovered critical concurrent job execution bug requiring investigation.
