---
layout: default
title: Daily Status - 2026-02-09
date: 2026-02-09
---

# Daily Status - 2026-02-09

## Accomplishments
- Completed provider abstraction refactoring for AAP Provisioning ([MGMT-22880](https://issues.redhat.com/browse/MGMT-22880))
  - Eliminated all provider type switches from controller by implementing rich result types (ProvisionResult, DeprovisionResult)
  - Added `BlockDeletionOnFailure` field to CRD for crash-safe deletion policies
  - Moved provider-specific logic (cancellation, finalizer checks) into provider implementations
  - Refactored AAP provider with helper methods (launchProvisionJob, isReadyForDeprovision, cancelProvisionJob, launchDeprovisionJob)
  - Updated EDA provider to internalize finalizer check logic
  - All 90+ unit tests passing, zero linter issues
  - Deployed refactored operator: `quay.io/etabak/cloudkit-operator:74ced2e`
- Fixed critical EDA deletion infinite polling bug
  - Root cause: EDA provider's GetDeprovisionStatus() always returned Running state
  - Solution: Added resource parameter to status methods, allowing EDA provider to check AAP finalizer for completion signal
  - Maintains clean abstraction - no controller changes needed
  - Deployed fixed operator: `quay.io/etabak/cloudkit-operator:96423b5`
  - Validated end-to-end with test script (creation, verification, deletion completed successfully)
  - Test instance `019c41fe-449f-7c8a-baf3-b4bfa59f6cd2` - all 23 ansible tasks passed

## Risks & Challenges
- **CRITICAL:** AAP Direct missing ReconciledConfigVersion update - AAP Direct doesn't set ReconciledConfigVersion when provision job succeeds, preventing controller from detecting spec changes vs already reconciled state. Fix needed in internal/provisioning/aap_provider.go:178 getJobStatus() to populate ReconciledVersion field when State=Succeeded.

## Key Effort
Eliminated all provider type switches from controller through provider abstraction refactoring, achieving clean separation of concerns and fixing EDA deletion infinite polling bug.
