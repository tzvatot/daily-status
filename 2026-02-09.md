---
layout: default
title: Daily Status - 2026-02-09
date: 2026-02-09
---

# Daily Status - 2026-02-09

## Accomplishments
- **Provider Abstraction Refactoring** - Eliminated all `switch r.ProvisioningProvider.Name()` type-checking statements from controller by introducing richer result types (`ProvisionResult`, `DeprovisionResult`) and moving provider-specific logic into provider implementations; added `BlockDeletionOnFailure` field to CRD for crash-safe deletion policies; all 90+ unit tests passing with zero linter issues; commits: `74ced2e`, `96423b5`
- **EDA Deletion Bug Fix** - Fixed infinite polling on EDA deletions by adding `resource client.Object` parameter to `GetProvisionStatus()` and `GetDeprovisionStatus()` interface methods, allowing EDA provider to check AAP finalizer removal to detect completion; maintains clean abstraction with no controller-specific EDA handling; deployed `quay.io/etabak/cloudkit-operator:96423b5`
- **Environment Fix: EDA Webhook Configuration** - Diagnosed and fixed latency experiment failures in vmaas-dev namespace where deployment was configured with non-existent service URLs (`innabox-eda-service:5000`); corrected to use `innabox-aap-eda-api:8000`; improved experiment script provider verification to check environment variables directly instead of pod logs; cleaned up stuck VMs and processes
- **EDA Performance Investigation** - Discovered and verified real 4.3x EDA provision time improvement (649s on Feb 8 â†’ ~140s on Feb 9); ruled out operator code changes as cause by testing official upstream image (`ghcr.io/osac-project/osac-operator:latest`) showing identical performance; identified speedup as external infrastructure improvement; corrected understanding of dynamic vs static EDA service architecture (webhook configuration `innabox-eda-service:5000` is correct, service is dynamically created by activation jobs)
- **Job State Mapping Inconsistencies Fixed** - Fixed critical bug where AAP status mapping incorrectly lumped `"pending"`, `"waiting"`, and `"running"` all into `JobStateRunning`, causing inconsistent status messages; added new states `JobStateWaiting` and `JobStateUnknown` to CRD; updated AAP provider to correctly map all AAP statuses; added comprehensive unit tests for all 8 status mappings; updated EDA provider to return `JobStateUnknown` (semantically correct for unpollable provider); deployed and validated with both AAP and EDA providers; commit `47428b4`
- **Test Automation Scripts Created** - Created `~/work/scripts/create_ci.sh` and `~/work/scripts/delete_ci.sh` for manual ComputeInstance lifecycle testing; created `~/work/scripts/monitor_experiment.sh` with 5-minute polling for latency experiments; improved `run_latency_experiment_parallel.sh` provider verification logic

## Risks & Challenges
- **Bug Discovered:** Observed concurrent provision and deprovision jobs running simultaneously on ComputeInstance `vm-jgkx2` during deletion - provision job 7265 remained Running when deprovision job 7267 was created, indicating AAP provider's `isReadyForDeprovision()` may not be properly cancelling provision jobs or waiting for cancellation to complete; requires investigation of race conditions and AAP job cancellation flow
- **Critical Issue:** AAP Direct provider missing ReconciledConfigVersion update - when provision job succeeds, AAP provider doesn't set `ReconciledConfigVersion` in status, preventing controller from detecting spec changes vs already-reconciled state; currently works only because `handleReconciledConfigVersion` reads annotation set by old EDA playbook; fix needed in `internal/provisioning/aap_provider.go:178` `getJobStatus()` to populate `ReconciledVersion` field when State=Succeeded

## Key Effort
Completed provider abstraction refactoring to eliminate all type-switching from controller and fixed multiple EDA-related bugs including deletion infinite polling and job state mapping inconsistencies.
