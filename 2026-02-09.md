---
layout: default
title: Daily Status - 2026-02-09
date: 2026-02-09
---

# Daily Status - 2026-02-09

## Accomplishments
- Completed provider abstraction refactoring for [MGMT-22880](https://issues.redhat.com/browse/MGMT-22880) - eliminated all `switch r.ProvisioningProvider.Name()` statements from controller using richer result types (ProvisionResult, DeprovisionResult) and CRD changes
- Added `BlockDeletionOnFailure` field to JobStatus CRD to store deletion policies set by providers during deprovision
- Updated ProvisioningProvider interface with new result types and internalized provider-specific logic (cancellation, finalizer checks) into provider implementations
- Modified AAP provider to set `BlockDeletionOnFailure: true` and return DeprovisionWaiting/DeprovisionTriggered states with extracted helper methods
- Modified EDA provider to check AAP finalizer internally and return DeprovisionSkipped/DeprovisionTriggered with `BlockDeletionOnFailure: false`
- Fixed EDA deletion infinite polling bug by adding resource parameter to `GetProvisionStatus()` and `GetDeprovisionStatus()` interface methods, allowing EDA provider to detect completion via finalizer removal
- All 90+ unit tests passing with zero linter issues (Controller: 40.8%, AAP: 86.7%, Provisioning: 68.3% coverage)
- Deployed refactored operator builds `quay.io/etabak/cloudkit-operator:74ced2e` and `quay.io/etabak/cloudkit-operator:96423b5`
- Validated full ComputeInstance lifecycle with test script including creation, verification, and successful deletion completion
- Commits: `74ced2e` (provider abstraction refactoring), `96423b5` (fix EDA deletion infinite polling)

## Risks & Challenges
- **CRITICAL:** AAP Direct missing ReconciledConfigVersion update - AAP Direct doesn't set ReconciledConfigVersion when provision job succeeds, preventing controller from detecting spec changes vs already reconciled state. Fix needed in `internal/provisioning/aap_provider.go:178` getJobStatus() to populate ReconciledVersion field when State=Succeeded

## Key Effort
Eliminating provider type switches from controller by implementing rich result types and moving provider-specific logic into provider implementations while maintaining clean abstraction
