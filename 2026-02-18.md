---
layout: default
title: Daily Status - 2026-02-18
date: 2026-02-18
---

# Daily Status - 2026-02-18

## Accomplishments

**Code Completion & Validation** ✅
- Fixed failing unit tests in `computeinstance_feedback_controller_test.go`
  - Updated 2 test fixtures to use `newTestComputeInstanceSpec()` helper
  - Ensures all required fields (cores, image, memoryGiB, bootDisk, runStrategy) are properly set
- Corrected import paths across entire codebase (61 files)
  - Migrated from `github.com/osac/osac-operator` to `github.com/osac-project/osac-operator`
- All validations passing:
  - ✅ Compilation
  - ✅ Formatting (go fmt)
  - ✅ Linter (golangci-lint): 0 issues
  - ✅ Unit tests: 42.7% controller coverage
  - ✅ Kustomize validation
  - ✅ Container build: `quay.io/etabak/cloudkit-operator:mgmt-23103-ca99608`

**Deployment** ✅
- Pushed 9 commits to fork (20 total in branch)
- Deployed operator to vmaas-dev cluster
- Image: `quay.io/etabak/cloudkit-operator:mgmt-23103-ca99608`
- Rollout completed successfully

**E2E Testing - Partial Success** ⚠️

Test Instance: `e2e-test-api-fields-10003548`

✅ **Provision Phase**:
- ComputeInstance created with explicit API fields (no templateParameters)
- Provision job 16063: Succeeded
- Template parameters generated correctly via `ensureBackwardCompatibility()`:
  - cpu_cores: 2
  - memory: 4Gi
  - disk_size: 20Gi
  - image_source: quay.io/containerdisks/fedora:latest
  - exposed_ports: 22/tcp
- ComputeInstance reached Running phase

✅ **RunStrategy Mutation Tests**:
- runStrategy=Halted: VM stopped successfully (spec.running=false, VMI terminated)
- runStrategy=Always: VM restarted successfully (spec.running=true, VMI running)

✅ **Immutability Validation Tests**:
- cores field: Patch rejected ✓
- memoryGiB field: Patch rejected ✓
- image field: Patch rejected ✓

❌ **Deprovision Phase**:
- Deprovision job 16067: Failed
- Error: "failed" (no detailed logs available - job expired)
- Operator logs confirm `ensureBackwardCompatibility()` was called before deprovision
- Parameters were sent to AAP via ansible_eda.event.payload structure
- Blocking deletion (as designed) to prevent orphaned resources

**PR Review Response - Addressed Adrien's Feedback** ✅
- Removed `syncRunStrategy()` controller logic (59 lines deleted)
- Removed direct VirtualMachine patching from controller
- Fixed import paths to current module name (`github.com/osac/osac-operator`)
- Cleaned up merge conflict backup files
- New behavior: runStrategy remains mutable, spec changes auto-trigger provision jobs, templates handle VirtualMachine state
- Validation: All unit tests pass (43.1% controller coverage), linter pass (0 issues), compilation successful
- Commit: `32ca27e` - "Remove syncRunStrategy() controller logic per PR review"

**Related Work**:
- Pull Request: https://github.com/osac-project/osac-operator/pull/111
- Enhancement Proposal: https://github.com/osac-project/enhancement-proposals/pull/21
- Jira: [MGMT-23103](https://issues.redhat.com/browse/MGMT-23103)

## Risks & Challenges

**Blocker: Module Path Mismatch**
- Cannot complete rebase of PR #111 due to incorrect module path in main branch
- Main branch uses `github.com/osac/osac-operator` but repository is at `github.com/osac-project/osac-operator`
- Blocked by PR #112 (module path fix) which must be merged first
- New files in PR #111 have import path mismatch

**Deprovision Failure Investigation Required**
- Deprovision playbook may need updates to handle new parameter structure
- Unknown why deprovision fails - need AAP logs to diagnose
- E2E test cannot complete until deprovision issue resolved

**Next Steps**:
1. ⏳ Wait for PR #112 to be merged
2. ⏳ Rebase PR #111 on updated main
3. ⏳ Verify linter passes
4. ⏳ Delete stuck test instance `e2e-test-api-fields-10003548`
5. ⏳ Run E2E test again and capture AAP job logs immediately
6. ⏳ Investigate AAP deprovision playbook
7. ⏳ Verify full lifecycle: provision → mutations → deprovision
8. ⏳ PR review and merge after E2E tests pass completely

## Key Effort

Completed full implementation and unit testing of ComputeInstance API enhancement for [MGMT-23103](https://issues.redhat.com/browse/MGMT-23103). Deployed to vmaas-dev and verified provision, runStrategy mutations, and immutability enforcement. Addressed PR review feedback by removing direct VM manipulation. Currently blocked on module path fix (PR #112) and investigating deprovision failure.
